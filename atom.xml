<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Michaelin&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://michaelin1208.github.io/"/>
  <updated>2020-02-25T07:10:01.730Z</updated>
  <id>https://michaelin1208.github.io/</id>
  
  <author>
    <name>Michael LIN</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CocoaPods 1.8.X pod install/update提示“[!] CDN: trunk Repo update failed”</title>
    <link href="https://michaelin1208.github.io/2020/02/25/iOS/CDN-trunk-Repo-update-failed/"/>
    <id>https://michaelin1208.github.io/2020/02/25/iOS/CDN-trunk-Repo-update-failed/</id>
    <published>2020-02-25T06:25:32.000Z</published>
    <updated>2020-02-25T07:10:01.730Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>在升级CocoaPods到1.8.X后，CocoaPods添加了CDN为默认的Spec repo源，而非原来以<a href="https://github.com/CocoaPods/Specs.git" target="_blank" rel="noopener">https://github.com/CocoaPods/Specs.git</a>为默认source，来缓解git上的specs过大带来的效率下降问题。这个改动造成了我在家中<code>pod install/update</code>的时候无法正常运行。</p><p>提示错误：<code>[!] CDN: trunk Repo update failed</code>以及失败的pods列表</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>网上关于这个问题的出现原因多半都是因为在中国大陆GFW的CDN拦截/访问控制等造成的Pods更新中遇到未知错误导致的。解决办法都是强制Podfile使用原来位于git的source地址(<a href="https://github.com/CocoaPods/Specs.git" target="_blank" rel="noopener">https://github.com/CocoaPods/Specs.git</a>)。</p><p>1.方法是在Podfile中添加代码，<code>source &#39;https://github.com/CocoaPods/Specs.git</code></p><p>2.在命令行中运行<code>pod repo remove master</code>来删除Pod中的CDN源。</p><p><strong>但是这样我们将无法享受到CDN带来的<code>pod install/update</code>速度变快的优势。</strong></p><p><strong>此外家里电脑具有“科学上网”能力，理论上不应该会导致该问题的出现。</strong></p><p>####我电脑上该问题的出现原因和解决办法</p><p>原因是我的本地系统的网络配置被之前安装的“科学上网”软件修改了，导致proxy异常而无法正确访问CocoaPods的CDN地址。</p><p>方法是关闭网络配置中当前连接的高级设置中的代理设置。如下图：</p><img src="/2020/02/25/iOS/CDN-trunk-Repo-update-failed/network-preferences.png" title="network preferences"><img src="/2020/02/25/iOS/CDN-trunk-Repo-update-failed/network-advanced-preferences.png" title="network advanced preferences"><p>关闭完代理设置后，就可以正常访问CocoaPods的CDN地址，正常使用<code>pod install/update</code>了。</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://www.jianshu.com/p/bf1cbe49cb5d" target="_blank" rel="noopener">[!] CDN: trunk Repo update failed</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h2&gt;&lt;p&gt;在升级CocoaPods到1.8.X后，CocoaPods添加了CDN为默认的Spec repo源，而非原来以&lt;a href
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://michaelin1208.github.io/tags/iOS/"/>
    
      <category term="CocoaPods" scheme="https://michaelin1208.github.io/tags/CocoaPods/"/>
    
      <category term="CDN" scheme="https://michaelin1208.github.io/tags/CDN/"/>
    
  </entry>
  
  <entry>
    <title>iOS13Lame压缩录音文件为MP3格式闪退</title>
    <link href="https://michaelin1208.github.io/2019/09/30/iOS/iOS13Lame%E5%8E%8B%E7%BC%A9%E5%BD%95%E9%9F%B3%E6%96%87%E4%BB%B6%E4%B8%BAMP3%E6%A0%BC%E5%BC%8F%E9%97%AA%E9%80%80/"/>
    <id>https://michaelin1208.github.io/2019/09/30/iOS/iOS13Lame压缩录音文件为MP3格式闪退/</id>
    <published>2019-09-30T06:49:53.000Z</published>
    <updated>2019-09-30T07:23:38.488Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>我们项目在语音发送用户评语时，使用了Lame三方库对客户端的pcm录音文件进行压缩，输出MP3文件。具体的Lame接入方法可以参考该文章 “<a href="https://github.com/CivelXu/iOS-Lame-Audio-transcoding" target="_blank" rel="noopener">iOS-Lame-Audio-transcoding</a>“.</p><p>在iOS13的iPhoneX/iPhoneXS等iPhone机中出现录音边录边压缩时闪退的问题。</p><p>问题类型<code>EXC_BAD_ACCESS</code>野指正，对象过早被释放导致。</p><p>异常出现的位置在<code>lame_encode_buffer_interleaved</code>方法调用中，该方法为Lame提供的方法，且输入的参数也没有发现野指针存在。Zombie调试没有发现有用的信息。刚开始考虑是Lame库太老了（我们还在使用4年前的库😅），更新了Lame库没有解决问题。</p><p>尝试运行<a href="https://github.com/CivelXu/iOS-Lame-Audio-transcoding" target="_blank" rel="noopener">iOS-Lame-Audio-transcoding</a>中提供的Demo，在我的设备中没有出现闪退现象。基本排除了Lame三方库的问题。</p><h2 id="问题根源和解决办法"><a href="#问题根源和解决办法" class="headerlink" title="问题根源和解决办法"></a>问题根源和解决办法</h2><p>对比demo和项目中对Lame库的使用，意外发现了我们在<strong><code>AVAudioRecorder</code></strong>初始化的<strong><code>setting</code></strong>参数有一句差异，项目中多了一句</p><p><strong><code>[settingDictionary setObject:@(YES) forKey:AVLinearPCMIsFloatKey];</code></strong></p><p>用于设置是否使用浮点数采样。</p><p>由于打开了浮点数采样导致了Lame压缩转换MP3时出现闪退。具体Lame中为何会出现浮点数采样转换Crash原因不明。怀疑是浮点数位数或者其他一些区别，导致Lame不适配。</p><p>记录下问题解决方式，方便新手排坑，欢迎大神指点。感谢🙏</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://github.com/CivelXu/iOS-Lame-Audio-transcoding" target="_blank" rel="noopener">iOS-Lame-Audio-transcoding</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h2&gt;&lt;p&gt;我们项目在语音发送用户评语时，使用了Lame三方库对客户端的pcm录音文件进行压缩，输出MP3文件。具体的Lame接入方法可
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://michaelin1208.github.io/tags/iOS/"/>
    
      <category term="闪退" scheme="https://michaelin1208.github.io/tags/%E9%97%AA%E9%80%80/"/>
    
      <category term="iOS13" scheme="https://michaelin1208.github.io/tags/iOS13/"/>
    
      <category term="iPhoneX" scheme="https://michaelin1208.github.io/tags/iPhoneX/"/>
    
      <category term="iPhoneXS" scheme="https://michaelin1208.github.io/tags/iPhoneXS/"/>
    
      <category term="Lame" scheme="https://michaelin1208.github.io/tags/Lame/"/>
    
      <category term="音频" scheme="https://michaelin1208.github.io/tags/%E9%9F%B3%E9%A2%91/"/>
    
      <category term="压缩" scheme="https://michaelin1208.github.io/tags/%E5%8E%8B%E7%BC%A9/"/>
    
      <category term="MP3" scheme="https://michaelin1208.github.io/tags/MP3/"/>
    
  </entry>
  
  <entry>
    <title>SourceTree和GitLab配合使用的问题</title>
    <link href="https://michaelin1208.github.io/2019/06/19/iOS/SourceTree%E5%92%8CGitLab%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>https://michaelin1208.github.io/2019/06/19/iOS/SourceTree和GitLab配合使用的问题/</id>
    <published>2019-06-19T06:41:46.000Z</published>
    <updated>2019-06-19T07:04:19.294Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>在使用SourceTree管理GitLab的时候出现了<strong>无法添加Repository</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is not a valid source path / URL</span><br></pre></td></tr></table></figure><p>或者<strong>无法Pull or Push</strong>的情况。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">remote: HTTP Basic: Access denied</span><br><span class="line">fatal: Authentication failed for &apos;https://gitlab.xxx/xxx.git/&apos;</span><br></pre></td></tr></table></figure><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>首先在添加或者pull/push的时候需要使用对应的<strong>Clone with SHH</strong>的地址如：“<a href="mailto:git@gitlab.xxx" target="_blank" rel="noopener">git@gitlab.xxx</a>/xxx.git”，而不是<strong>Clone with HTTPS</strong>的地址。</p><p>如图：<img src="/2019/06/19/iOS/SourceTree和GitLab配合使用的问题/ssh.jpg" title="ssh"></p><p>其次，在MacOS中，SourceTree的Preference中并不提供指定公私钥的配置。我们需要在生成公私钥的时候对私钥进行<strong>ssh-add</strong>，如：<code>ssh-add id_rsa</code></p><p>同时在公司gitlab页面上设置好SSH使用的私钥对应的公钥。</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://blog.csdn.net/lele9096_bk/article/details/54950391" target="_blank" rel="noopener">Mac 下source tree 与 gitlab 添加 ssh 密钥</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h2&gt;&lt;p&gt;在使用SourceTree管理GitLab的时候出现了&lt;strong&gt;无法添加Repository&lt;/strong&gt;&lt;/p&gt;
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="MacOS" scheme="https://michaelin1208.github.io/tags/MacOS/"/>
    
      <category term="SourceTree" scheme="https://michaelin1208.github.io/tags/SourceTree/"/>
    
      <category term="GitLab" scheme="https://michaelin1208.github.io/tags/GitLab/"/>
    
      <category term="SSH" scheme="https://michaelin1208.github.io/tags/SSH/"/>
    
  </entry>
  
  <entry>
    <title>WKWebView的坑之iOS9以下版本退出闪退</title>
    <link href="https://michaelin1208.github.io/2019/04/25/iOS/WKWebView%E7%9A%84%E5%9D%91%E4%B9%8BiOS9%E4%BB%A5%E4%B8%8B%E7%89%88%E6%9C%AC%E8%AE%BE%E7%BD%AEscrollView-delegate%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%80%80%E5%87%BA%E9%97%AA%E9%80%80/"/>
    <id>https://michaelin1208.github.io/2019/04/25/iOS/WKWebView的坑之iOS9以下版本设置scrollView-delegate带来的退出闪退/</id>
    <published>2019-04-25T09:00:46.000Z</published>
    <updated>2019-04-25T09:59:48.455Z</updated>
    
    <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在iOS9及以下版本中，<code>WKWebView</code>在自定义了他的<code>scrollView.delegate</code>为当前<code>ViewController</code>时，如果退出当前<code>ViewController</code>会闪退。提醒<code>EXC_BAD_ACCESS</code>错误并且闪退，</p><p>错误堆栈是<code>-[UIScrollView(AdhocVisualEdit) adhoc_scrollViewSetDelegate:]</code></p><p>上一级是<code>-[WKScrollView _updateDelegate]</code>。</p><h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><p>考虑是在iOS9及以下版本中，苹果对于<code>delegate</code>的<code>weak</code>的处理没有如预期。导致在退出当前<code>ViewController</code>的时候更新<code>scrollView</code>的<code>delegate</code>还是使用了已经释放的<code>ViewController</code>，从而导致<code>EXC_BAD_ACCESS</code>错误而闪退。</p><p>这个问题在iOS10及以上版本中已经修复，不再闪退。</p><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>在当前<code>ViewController</code>释放的时候，设置<code>WKWebView</code>的<code>scrollView.delegate</code>为nil。</p><p>代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// Objective-C</span><br><span class="line">- (void)dealloc</span><br><span class="line">&#123;</span><br><span class="line">    _webView.scrollView.delegate = nil;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Swift</span><br><span class="line">deinit &#123;</span><br><span class="line">    webView.scrollView.delegate = nil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Reference-List"><a href="#Reference-List" class="headerlink" title="Reference List"></a>Reference List</h3><p><a href="https://stackoverflow.com/questions/38733634/ios-wkwebview-scrollview-delegate-cause-bad-access" target="_blank" rel="noopener">iOS WKWebView.scrollView delegate cause BAD_ACCESS</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h3&gt;&lt;p&gt;在iOS9及以下版本中，&lt;code&gt;WKWebView&lt;/code&gt;在自定义了他的&lt;code&gt;scrollView.dele
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://michaelin1208.github.io/tags/iOS/"/>
    
      <category term="WKWebView" scheme="https://michaelin1208.github.io/tags/WKWebView/"/>
    
      <category term="scrollView" scheme="https://michaelin1208.github.io/tags/scrollView/"/>
    
      <category term="delegate" scheme="https://michaelin1208.github.io/tags/delegate/"/>
    
      <category term="闪退" scheme="https://michaelin1208.github.io/tags/%E9%97%AA%E9%80%80/"/>
    
  </entry>
  
  <entry>
    <title>iOS开发实用工具</title>
    <link href="https://michaelin1208.github.io/2019/04/23/iOS/iOS%E5%BC%80%E5%8F%91%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7/"/>
    <id>https://michaelin1208.github.io/2019/04/23/iOS/iOS开发实用工具/</id>
    <published>2019-04-23T07:14:35.000Z</published>
    <updated>2019-04-23T07:38:25.531Z</updated>
    
    <content type="html"><![CDATA[<h3 id="iOS开发实用工具"><a href="#iOS开发实用工具" class="headerlink" title="iOS开发实用工具"></a>iOS开发实用工具</h3><h4 id="Chisel"><a href="#Chisel" class="headerlink" title="Chisel"></a>Chisel</h4><p>一款由Facebook分享的丰富LLDB命令的开源工具，<a href="https://github.com/facebook/chisel" target="_blank" rel="noopener">具体的安装方法和介绍参考官方github。</a></p><p>通过该工具我们可以快速定位当前显示的图层层级，展示任意<code>UIImage</code> /<code>CGImageRef</code> /<code>UIView</code>等对象的内容，显示某个对象的响应链等各种功能。大大提高我们在debug时的效率。尤其对于视图相关的问题，相比Xcode提供的<code>Debug View Hierarchy</code>功能，Chisel能提供更快速的响应和更加直观和针对性的显示。而<code>Debug View Hierarchy</code>则更加的形象。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;iOS开发实用工具&quot;&gt;&lt;a href=&quot;#iOS开发实用工具&quot; class=&quot;headerlink&quot; title=&quot;iOS开发实用工具&quot;&gt;&lt;/a&gt;iOS开发实用工具&lt;/h3&gt;&lt;h4 id=&quot;Chisel&quot;&gt;&lt;a href=&quot;#Chisel&quot; class=&quot;head
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://michaelin1208.github.io/tags/iOS/"/>
    
      <category term="Utilities" scheme="https://michaelin1208.github.io/tags/Utilities/"/>
    
      <category term="Chisel" scheme="https://michaelin1208.github.io/tags/Chisel/"/>
    
  </entry>
  
  <entry>
    <title>让App在iOS12中支持Siri Shortcuts(捷径)功能 和 “设置和捷径App内未列出自己App的Shortcut” 的解决办法</title>
    <link href="https://michaelin1208.github.io/2018/10/10/iOS/%E8%AE%A9App%E5%9C%A8iOS12%E4%B8%AD%E6%94%AF%E6%8C%81Siri-Shortcuts-%E6%8D%B7%E5%BE%84-%E5%8A%9F%E8%83%BD/"/>
    <id>https://michaelin1208.github.io/2018/10/10/iOS/让App在iOS12中支持Siri-Shortcuts-捷径-功能/</id>
    <published>2018-10-10T10:33:46.000Z</published>
    <updated>2018-10-30T07:45:13.285Z</updated>
    
    <content type="html"><![CDATA[<p><strong>最近发现的问题 “设置和捷径App内未列出自己App的Shortcut” 的解决办法在文章末尾</strong></p><h3 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h3><p>WWDC 2018 苹果更新了Siri使其支持Shortcuts功能，中文名“捷径”。支持用户通过自定义把一系列操作合并到一个Shortcut内。苹果官方应用提供了一些接口供Shortcut调用，如Map应用的“获取行程时间”，“显示路线”等。如果我们的应用需要支持，需要自己在App中开放可以被Shortcuts访问的接口。同时苹果正在大力推广这个Siri新功能，支持软件可在<a href="https://itunes.apple.com/cn/story/id1436260234" target="_blank" rel="noopener">苹果App Store榜单“用 Siri，走捷径”</a>中列出，有一定推广作用。该功能也有利于增加用户粘度和活跃人数。</p><p>Apple提供了官方关于Shortcuts的<a href="https://developer.apple.com/documentation/sirikit/soup_chef_accelerating_app_interactions_with_shortcuts?language=objc" target="_blank" rel="noopener">demo</a>，但是在苹果大力推广Swift的浪潮下，demo的语言也是Swift版的，无奈公司现在还在使用Objc，下面介绍下Objc下的接入过程。</p><h3 id="创建Custom-Intent"><a href="#创建Custom-Intent" class="headerlink" title="创建Custom Intent"></a>创建Custom Intent</h3><p>在项目中通过“New File…”创建一个<code>Intents.intentdefinition</code>文件。这个文件用来定义自定义<code>intent</code>类型。</p><img src="/2018/10/10/iOS/让App在iOS12中支持Siri-Shortcuts-捷径-功能/SiriKitIntentDefinitionFile.png" title="新建SiriKit Intent Definition File"><img src="/2018/10/10/iOS/让App在iOS12中支持Siri-Shortcuts-捷径-功能/CustomIntents.png" title="设置Custom Intents"><p>同时会自动在项目的<code>Info.plist</code>文件中添加<code>NSUserActivityTypes</code></p><img src="/2018/10/10/iOS/让App在iOS12中支持Siri-Shortcuts-捷径-功能/InfoPlist.png" title="Info.plist"><h3 id="添加Frameworks"><a href="#添加Frameworks" class="headerlink" title="添加Frameworks"></a>添加Frameworks</h3><p>在项目的<strong>Build Phases</strong>中的<strong>Link Binary With Libraries</strong>中添加<code>Intents.framework</code>和<code>IntentsUI.framework</code>。</p><img src="/2018/10/10/iOS/让App在iOS12中支持Siri-Shortcuts-捷径-功能/Frameworks.png" title="Frameworks"><h3 id="添加Shortcut按钮"><a href="#添加Shortcut按钮" class="headerlink" title="添加Shortcut按钮"></a>添加Shortcut按钮</h3><p>在项目中需要调用添加Shortcut按钮的.m文件中，</p><h4 id="增加import"><a href="#增加import" class="headerlink" title="增加import"></a>增加import</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Intents/Intents.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;IntentsUI/IntentsUI.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"HWTakePhotoIntent.h"</span>//上方“设置Custom Intents”图中右边箭头指的“Class Name”</span></span><br></pre></td></tr></table></figure><h4 id="添加Delegate"><a href="#添加Delegate" class="headerlink" title="添加Delegate"></a>添加Delegate</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;INUIAddVoiceShortcutButtonDelegate,</span><br><span class="line">INUIAddVoiceShortcutViewControllerDelegate,</span><br><span class="line">INUIEditVoiceShortcutViewControllerDelegate&gt;</span><br></pre></td></tr></table></figure><h4 id="添加Property"><a href="#添加Property" class="headerlink" title="添加Property"></a>添加Property</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) HWTakePhotoIntent API_AVAILABLE(ios(<span class="number">12.0</span>)) *intent;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) INUIAddVoiceShortcutButton API_AVAILABLE(ios(<span class="number">12.0</span>)) *shortcutButton;</span><br></pre></td></tr></table></figure><h4 id="添加shortcutButton按钮"><a href="#添加shortcutButton按钮" class="headerlink" title="添加shortcutButton按钮"></a>添加shortcutButton按钮</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (@available(iOS <span class="number">12.0</span>, *)) &#123;</span><br><span class="line">    _shortcutButton = [[INUIAddVoiceShortcutButton alloc] initWithStyle:INUIAddVoiceShortcutButtonStyleWhiteOutline];</span><br><span class="line">    _shortcutButton.shortcut = [[INShortcut alloc] initWithIntent:<span class="keyword">self</span>.intent];</span><br><span class="line">    _shortcutButton.translatesAutoresizingMaskIntoConstraints = <span class="literal">false</span>;</span><br><span class="line">    _shortcutButton.delegate = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:_shortcutButton];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="设置intent属性"><a href="#设置intent属性" class="headerlink" title="设置intent属性"></a>设置intent属性</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (HWTakePhotoIntent *)intent API_AVAILABLE(ios(<span class="number">12.0</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_intent) &#123;</span><br><span class="line">        _intent = [[HWTakePhotoIntent alloc] init];</span><br><span class="line">        _intent.suggestedInvocationPhrase = <span class="string">@"开始改作业"</span>;<span class="comment">//在Siri语音设置时显示的建议设置唤起文字</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _intent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="设置对应delegate方法"><a href="#设置对应delegate方法" class="headerlink" title="设置对应delegate方法"></a>设置对应delegate方法</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - INUIAddVoiceShortcutButtonDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)presentAddVoiceShortcutViewController:(INUIAddVoiceShortcutViewController *)addVoiceShortcutViewController forAddVoiceShortcutButton:(INUIAddVoiceShortcutButton *)addVoiceShortcutButton API_AVAILABLE(ios(<span class="number">12.0</span>))&#123;</span><br><span class="line">    addVoiceShortcutViewController.delegate = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span> presentViewController:addVoiceShortcutViewController animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)presentEditVoiceShortcutViewController:(INUIEditVoiceShortcutViewController *)editVoiceShortcutViewController forAddVoiceShortcutButton:(INUIAddVoiceShortcutButton *)addVoiceShortcutButton API_AVAILABLE(ios(<span class="number">12.0</span>))&#123;</span><br><span class="line">    editVoiceShortcutViewController.delegate = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="keyword">self</span> presentViewController:editVoiceShortcutViewController animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - INUIAddVoiceShortcutViewControllerDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)addVoiceShortcutViewController:(INUIAddVoiceShortcutViewController *)controller didFinishWithVoiceShortcut:(INVoiceShortcut *)voiceShortcut error:(<span class="built_in">NSError</span> *)error</span><br><span class="line">API_AVAILABLE(ios(<span class="number">12.0</span>))&#123;</span><br><span class="line">    [controller dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addVoiceShortcutViewControllerDidCancel:(INUIAddVoiceShortcutViewController *)controller API_AVAILABLE(ios(<span class="number">12.0</span>))&#123;</span><br><span class="line">    [controller dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark - INUIEditVoiceShortcutViewControllerDelegate</span></span><br><span class="line">- (<span class="keyword">void</span>)editVoiceShortcutViewControllerDidCancel:(INUIEditVoiceShortcutViewController *)controller API_AVAILABLE(ios(<span class="number">12.0</span>))&#123;</span><br><span class="line">    [controller dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)editVoiceShortcutViewController:(INUIEditVoiceShortcutViewController *)controller didUpdateVoiceShortcut:(INVoiceShortcut *)voiceShortcut error:(<span class="built_in">NSError</span> *)error API_AVAILABLE(ios(<span class="number">12.0</span>))&#123;</span><br><span class="line">    [controller dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)editVoiceShortcutViewController:(INUIEditVoiceShortcutViewController *)controller didDeleteVoiceShortcutWithIdentifier:(<span class="built_in">NSUUID</span> *)deletedVoiceShortcutIdentifier API_AVAILABLE(ios(<span class="number">12.0</span>))&#123;</span><br><span class="line">    [controller dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AppDelegate-m文件中添加方法"><a href="#AppDelegate-m文件中添加方法" class="headerlink" title="AppDelegate.m文件中添加方法"></a>AppDelegate.m文件中添加方法</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application continueUserActivity:(<span class="built_in">NSUserActivity</span> *)userActivity restorationHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSArray</span>&lt;<span class="keyword">id</span>&lt;<span class="built_in">UIUserActivityRestoring</span>&gt;&gt; * _Nullable))restorationHandler</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// activityType 和 Info.plist中的NSUserActivityTypes内容对应</span></span><br><span class="line">    <span class="keyword">if</span> ([userActivity.activityType isEqualToString:<span class="string">@"HWTakePhotoIntent"</span>]) &#123;</span><br><span class="line">        [HWNotificationCenter postNotificationName:kNotificationOpenCamera object:<span class="literal">nil</span>];<span class="comment">// 通过通知找到对应class处理activity</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用于在Siri中通过设定语音调起应用时处理Siri的请求。我们的项目中是打开摄像头拍照批改作业。</p><h3 id="iOS12-Siri-Known-Issues"><a href="#iOS12-Siri-Known-Issues" class="headerlink" title="iOS12 Siri Known Issues"></a>iOS12 Siri Known Issues</h3><img src="/2018/10/10/iOS/让App在iOS12中支持Siri-Shortcuts-捷径-功能/iOS12SiriKnownIssues.png" title="iOS12 Siri Known Issues"><p>如上图红框所示，<a href="https://developer.apple.com/documentation/ios_release_notes/ios_12_release_notes?language=objc" target="_blank" rel="noopener">iOS12发布后已知问题</a>之一是系统的<code>INUIAddVoiceShortcutButton</code>只支持默认的标题“Add to Siri”和“Added to Siri”，没有做本地化支持😂。此外按钮的样式也很死，无法自由自在的自定义，所以灰溜溜的只能自己来写自定义按钮了。</p><h4 id="需求一：判断是否添加过该shortcut来区别跳转INUIAddVoiceShortcutViewController还是INUIEditVoiceShortcutViewController"><a href="#需求一：判断是否添加过该shortcut来区别跳转INUIAddVoiceShortcutViewController还是INUIEditVoiceShortcutViewController" class="headerlink" title="需求一：判断是否添加过该shortcut来区别跳转INUIAddVoiceShortcutViewController还是INUIEditVoiceShortcutViewController"></a>需求一：判断是否添加过该shortcut来区别跳转<code>INUIAddVoiceShortcutViewController</code>还是<code>INUIEditVoiceShortcutViewController</code></h4><p>当然苹果为我们提供了<code>INVoiceShortcutCenter</code> 的<code>- (void)getAllVoiceShortcutsWithCompletion:(void(^)(NSArray&lt;INVoiceShortcut *&gt; * _Nullable voiceShortcuts, NSError * _Nullable error))completionHandler;</code>方法来获得所有添加的Shortcuts或者<code>- (void)getVoiceShortcutWithIdentifier:(NSUUID *)identifier completion:(void(^)(INVoiceShortcut * _Nullable voiceShortcut, NSError * _Nullable error))completionHandler NS_SWIFT_NAME(getVoiceShortcut(with:completion:));</code>通过identifier查找对应的Shortcut。</p><p>我在项目中的按钮点击事件代码如下：</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)shortcutButtonClicked:(<span class="built_in">UIButton</span> *)sender</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (@available(iOS <span class="number">12.0</span>, *)) &#123;</span><br><span class="line">        [[INVoiceShortcutCenter sharedCenter] getAllVoiceShortcutsWithCompletion:^(<span class="built_in">NSArray</span>&lt;INVoiceShortcut *&gt; * _Nullable voiceShortcuts, <span class="built_in">NSError</span> * _Nullable error) &#123;</span><br><span class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                <span class="built_in">BOOL</span> tempAddedShortcut = <span class="literal">NO</span>;</span><br><span class="line">                <span class="keyword">for</span> (INVoiceShortcut *voiceShortcut <span class="keyword">in</span> voiceShortcuts) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ([voiceShortcut.shortcut.intent isKindOfClass:[HWTakePhotoIntent <span class="keyword">class</span>]]) &#123;</span><br><span class="line">                        tempAddedShortcut = <span class="literal">YES</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">self</span>.addedShortcut = tempAddedShortcut;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">self</span>.addedShortcut) &#123;</span><br><span class="line">                    INUIEditVoiceShortcutViewController *editVoiceShortcutViewController = [[INUIEditVoiceShortcutViewController alloc] initWithVoiceShortcut:voiceShortcuts[<span class="number">0</span>]];</span><br><span class="line">                    editVoiceShortcutViewController.delegate = <span class="keyword">self</span>;</span><br><span class="line">                    [<span class="keyword">self</span> presentViewController:editVoiceShortcutViewController animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    INShortcut *shortcut = [[INShortcut alloc] initWithIntent:<span class="keyword">self</span>.intent];</span><br><span class="line">                    INUIAddVoiceShortcutViewController *addVoiceShortcutViewController = [[INUIAddVoiceShortcutViewController alloc] initWithShortcut:shortcut];</span><br><span class="line">                    addVoiceShortcutViewController.delegate = <span class="keyword">self</span>;</span><br><span class="line">                    [<span class="keyword">self</span> presentViewController:addVoiceShortcutViewController animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="需求二：通过INUIAddVoiceShortcutViewController和INUIEditVoiceShortcutViewController的Delegates更新自定义Shortcut按钮状态"><a href="#需求二：通过INUIAddVoiceShortcutViewController和INUIEditVoiceShortcutViewController的Delegates更新自定义Shortcut按钮状态" class="headerlink" title="需求二：通过INUIAddVoiceShortcutViewController和INUIEditVoiceShortcutViewController的Delegates更新自定义Shortcut按钮状态"></a>需求二：通过<code>INUIAddVoiceShortcutViewController</code>和<code>INUIEditVoiceShortcutViewController</code>的Delegates更新自定义Shortcut按钮状态</h4><p>同样也需要用到需求一中提到的判断是否添加过当前Shortcut来更新对应的自定义Shortcut按钮样式。</p><h3 id="“设置和捷径App内未列出自己App的Shortcut”-的解决办法"><a href="#“设置和捷径App内未列出自己App的Shortcut”-的解决办法" class="headerlink" title="“设置和捷径App内未列出自己App的Shortcut” 的解决办法"></a>“设置和捷径App内未列出自己App的Shortcut” 的解决办法</h3><h4 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h4><p>按照上文介绍，一步步在自己的App中添加Shortcut功能成功后，我们并不能在系统的<code>设置</code>应用的<code>Siri 与 搜索</code>中看到我们刚刚添加的Shortcut，或者在<code>捷径</code>应用中找到。如下图：</p><img src="/2018/10/10/iOS/让App在iOS12中支持Siri-Shortcuts-捷径-功能/SettingMenuWithoutShortcuts.PNG" title="Setting Menu Without Shortcuts"><p>如果我们通过上文中定义的App内的<code>Add to Siri</code>按钮添加用户的Shortcut到Siri成功后，我们依然可以在<code>设置</code>和<code>捷径</code>应用中看到。但是如果删除添加的Shortcut，有都会消失。这显然不是我们需要的效果。</p><p>预期效果是不管用户是否在App内添加Shortcut到Siri，都应在<code>设置</code>和<code>捷径</code>应用中看到。</p><h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><p>我们需要自己手动更新我们应用的Shortcut Suggestions的内容，这样才能在<code>设置</code>和<code>捷径</code>应用中列出。</p><p>更新Shortcut Suggestions内容的代码如下。</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)addMenuItemShortcuts</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">AVAILABLE</span>(<span class="number">12.0</span>)) &#123;</span><br><span class="line">        HWTakePhotoIntent *intent = [[HWTakePhotoIntent alloc] init];</span><br><span class="line">        intent.suggestedInvocationPhrase = <span class="built_in">NSLocalizedString</span>(<span class="string">@"SIRI_SHORTCUT_CORRECT_WORK"</span>, <span class="literal">nil</span>);</span><br><span class="line">        [[INVoiceShortcutCenter sharedCenter] setShortcutSuggestions:@[[[INShortcut alloc] initWithIntent:intent]]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我是在<code>AppDelegate</code>的<code>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions</code>里做了初始化。</p><p>更新Shortcut Suggestions内容后，即使不在应用内添加Shortcut到Siri，在<code>设置</code>和<code>捷径</code>应用中仍能找到应用提供的Shortcut建议。</p><p><code>设置</code>中的界面如下</p><img src="/2018/10/10/iOS/让App在iOS12中支持Siri-Shortcuts-捷径-功能/SettingMenuWithShortcuts.PNG" title="Setting Menu With Shortcuts"><p>点击<code>捷径</code>进入后如下</p><img src="/2018/10/10/iOS/让App在iOS12中支持Siri-Shortcuts-捷径-功能/SettingMenuWithShortcutsContent.PNG" title="Setting Menu With Shortcuts Content"><p>如果你需要，也可以在其他需要的时候更新Shortcut Suggestions内容。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>Siri Shortcut大功告成</p><h3 id="References"><a href="#References" class="headerlink" title="References:"></a>References:</h3><p><a href="https://www.jianshu.com/p/19b248333b18" target="_blank" rel="noopener">iOS12 Siri Shortcuts初探</a></p><p><a href="https://developer.apple.com/design/human-interface-guidelines/sirikit/overview/" target="_blank" rel="noopener">Human Interface Guidelines - SiriKit</a></p><p><a href="https://developer.apple.com/documentation/sirikit?language=objc" target="_blank" rel="noopener">Documentation - SiriKit</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;最近发现的问题 “设置和捷径App内未列出自己App的Shortcut” 的解决办法在文章末尾&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;背景介绍&quot;&gt;&lt;a href=&quot;#背景介绍&quot; class=&quot;headerlink&quot; title=&quot;背景介绍&quot;&gt;&lt;/a&gt;背景
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS12" scheme="https://michaelin1208.github.io/tags/iOS12/"/>
    
      <category term="Siri" scheme="https://michaelin1208.github.io/tags/Siri/"/>
    
      <category term="Shortcuts" scheme="https://michaelin1208.github.io/tags/Shortcuts/"/>
    
      <category term="捷径" scheme="https://michaelin1208.github.io/tags/%E6%8D%B7%E5%BE%84/"/>
    
      <category term="设置" scheme="https://michaelin1208.github.io/tags/%E8%AE%BE%E7%BD%AE/"/>
    
  </entry>
  
  <entry>
    <title>WKWebView的坑之图片显示不完全</title>
    <link href="https://michaelin1208.github.io/2018/08/20/iOS/WKWebView%E7%9A%84%E5%9D%91%E4%B9%8B%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%AE%8C%E5%85%A8/"/>
    <id>https://michaelin1208.github.io/2018/08/20/iOS/WKWebView的坑之图片显示不完全/</id>
    <published>2018-08-20T11:33:46.000Z</published>
    <updated>2018-11-05T09:17:31.610Z</updated>
    
    <content type="html"><![CDATA[<h3 id="最近在做iPad-Pro适配时遇到了WKWebView图片显示不完全的坑"><a href="#最近在做iPad-Pro适配时遇到了WKWebView图片显示不完全的坑" class="headerlink" title="最近在做iPad Pro适配时遇到了WKWebView图片显示不完全的坑"></a>最近在做iPad Pro适配时遇到了WKWebView图片显示不完全的坑</h3><p>在显示网页中的大尺寸图片时，图片显示不完整，有些是下方不显示，有些是下方和右侧都不显示。流程如下</p><h5 id="第一类情况"><a href="#第一类情况" class="headerlink" title="第一类情况"></a>第一类情况</h5><p><img src="https://upload-images.jianshu.io/upload_images/2312364-5a6e47876e988237.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/500" alt="1. APP下方题目卡片初始状态"><br>在卡片出现时，显示了<code>WKWebView</code>上部内容。<br><img src="https://upload-images.jianshu.io/upload_images/2312364-58e01f9d020b7ab4.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/500" alt="2. APP下方题目卡片展开状态"><br>点击卡片下方展开按钮或者上划手势，展开卡片，可以看到更多网页内容，但是下方图片无内容成白色。滑动图片后网页内容图片刷新，显示正常，如下<br><img src="https://upload-images.jianshu.io/upload_images/2312364-d70c883c7f0cf985.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/500" alt="3. APP下方题目卡片拖动后显示"></p><h5 id="第二类情况"><a href="#第二类情况" class="headerlink" title="第二类情况"></a>第二类情况</h5><p>如果<code>WKWebView</code>的初始状态为不可见时，如下<br><img src="https://upload-images.jianshu.io/upload_images/2312364-083090e32636521a.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/500" alt="4. APP下方题目卡片初始状态"><br>点击展开卡片，显示的图片只有左上角一小条，其他内容缺失，如下<br><img src="https://upload-images.jianshu.io/upload_images/2312364-288e0a0459020401.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/500" alt="5. APP下方题目卡片展开状态"><br>同样滑动后页面会刷新，图片显示恢复正常。<br><img src="https://upload-images.jianshu.io/upload_images/2312364-615209bc1fb73fc7.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/500" alt="6. APP下方题目卡片拖动后显示"></p><h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><p><code>WKWebView</code>相比<code>UIWebView</code>提高了页面渲染载入速度，其中也包括只对展示给用户可见的内容进行渲染，这样可以大大提高载入速度。如我遇到的图片问题，<code>WKWebView</code>会把图片分割成多块，如下图A-F六块区域。<br><img src="https://upload-images.jianshu.io/upload_images/2312364-ee5da42980f501a9.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/500" alt="WKWebView对图片分割成多块渲染"><br>在第一类情况，由于A/B/C块都是用户可见区域，所以<code>WKWebView</code>对这三块区域进行了渲染，而D/E/F块都没有渲染。所以展开卡片时，他也呈现空白状态，图片缺失。<br>第二类情况则是所有区域都不在用户可视范围内，所以他仅对A块渲染，展开后B/C/D/E/F都为空白，图片缺失。这个可以在<code>XCode</code>的<code>Debug View Hierarchy</code>中得到验证，完整渲染的有六个区域，第一种情况三个区域，第二种状况只有一种区域。</p><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>填坑办法就是强制让<code>WKWebView</code>重新渲染一次，代码如下</p><p><code>[_webView setNeedsLayout];</code></p><p>我是在展开卡片时增加了<code>WKWebView</code>强制重新渲染的代码实现。而对于网上提到比较多的，在<code>UITableView</code>中添加<code>WKWebView</code>图片载入不全的情况可以在<code>- (void)scrollViewDidScroll:(UIScrollView *)scrollView</code>中增加强制重新渲染的代码来解决。声称这个坑在iOS11中得到了修复，但是我的11.3的iPad Pro还是遇到了这个问题😂，可能是我们的WKWebView操作没有触发重新渲染吧。</p><p>———————————————– 编辑于20180821 ——————————————————-<br>最近出现了在iOS 8.2系统下图片显示过大，超出屏幕的问题。可以通过<code>addUserScript</code>解决，如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NSString *jScript = @&quot;var meta = document.createElement(&apos;meta&apos;); meta.setAttribute(&apos;name&apos;, &apos;viewport&apos;); meta.setAttribute(&apos;content&apos;, &apos;width=device-width&apos;); document.getElementsByTagName(&apos;head&apos;)[0].appendChild(meta);&quot;;</span><br><span class="line">WKUserScript *wkUScript = [[WKUserScript alloc] initWithSource:jScript injectionTime:WKUserScriptInjectionTimeAtDocumentEnd forMainFrameOnly:YES];</span><br><span class="line">WKUserContentController *wkUController = [[WKUserContentController alloc] init];</span><br><span class="line">[wkUController addUserScript:wkUScript];</span><br><span class="line">[[_webView configuration].userContentController addUserScript:wkUScript];</span><br></pre></td></tr></table></figure></p><h3 id="Reference-List"><a href="#Reference-List" class="headerlink" title="Reference List"></a>Reference List</h3><p><a href="https://stackoverflow.com/questions/39549103/wkwebview-not-rendering-correctly-in-ios-10" target="_blank" rel="noopener">WKWebView not rendering correctly in iOS 10</a><br><a href="https://www.jianshu.com/p/2338775fd256" target="_blank" rel="noopener">使用WKWebView 适应屏幕尺寸</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;最近在做iPad-Pro适配时遇到了WKWebView图片显示不完全的坑&quot;&gt;&lt;a href=&quot;#最近在做iPad-Pro适配时遇到了WKWebView图片显示不完全的坑&quot; class=&quot;headerlink&quot; title=&quot;最近在做iPad Pro适配时遇到了WK
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://michaelin1208.github.io/tags/iOS/"/>
    
      <category term="WKWebView" scheme="https://michaelin1208.github.io/tags/WKWebView/"/>
    
      <category term="图片显示不全" scheme="https://michaelin1208.github.io/tags/%E5%9B%BE%E7%89%87%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>iOS中通过CGContext实现图片围绕任意点旋转任意角度的功能</title>
    <link href="https://michaelin1208.github.io/2018/07/24/iOS/iOS%E4%B8%AD%E9%80%9A%E8%BF%87CGContext%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E5%9B%B4%E7%BB%95%E4%BB%BB%E6%84%8F%E7%82%B9%E6%97%8B%E8%BD%AC%E4%BB%BB%E6%84%8F%E8%A7%92%E5%BA%A6%E7%9A%84%E5%8A%9F%E8%83%BD/"/>
    <id>https://michaelin1208.github.io/2018/07/24/iOS/iOS中通过CGContext实现图片围绕任意点旋转任意角度的功能/</id>
    <published>2018-07-24T02:33:46.000Z</published>
    <updated>2018-10-30T07:45:13.284Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>需要围绕任意点旋转若干角度返回和原始图片大小相同的图片。</p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>代码如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">UIImage</span> *)getRotationImage:(<span class="built_in">UIImage</span> *)image rotation:(<span class="built_in">CGFloat</span>)rotation point:(<span class="built_in">CGPoint</span>)point &#123;</span><br><span class="line">    <span class="built_in">NSInteger</span> num = (<span class="built_in">NSInteger</span>)(floor(rotation));</span><br><span class="line">    <span class="keyword">if</span> (num == rotation &amp;&amp; num % <span class="number">360</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> image;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">double</span> radius = rotation * M_PI / <span class="number">180</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGSize</span> rotatedSize = image.size;</span><br><span class="line">    <span class="comment">// Create the bitmap context</span></span><br><span class="line">    <span class="built_in">UIGraphicsBeginImageContext</span>(rotatedSize);</span><br><span class="line">    <span class="built_in">CGContextRef</span> bitmap = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// rotated image view</span></span><br><span class="line">    <span class="built_in">CGContextScaleCTM</span>(bitmap, <span class="number">1.0</span>, <span class="number">-1.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// move to the rotation relative point</span></span><br><span class="line">    <span class="built_in">CGContextTranslateCTM</span>(bitmap, point.x, -point.y);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Rotate the image context</span></span><br><span class="line">    <span class="built_in">CGContextRotateCTM</span>(bitmap, radius);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Now, draw the rotated/scaled image into the context</span></span><br><span class="line">    <span class="built_in">CGContextDrawImage</span>(bitmap, <span class="built_in">CGRectMake</span>(-point.x, -image.size.height+point.y, image.size.width, image.size.height), [image <span class="built_in">CGImage</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIImage</span> *newImage = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">    <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">    <span class="keyword">return</span> newImage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>输入：</strong>需要旋转的图片，旋转的角度，和旋转围绕的点。<br><strong>返回：</strong>旋转后同样大小的结果图片。</p><p>调试<code>CGContext</code>的时候需要注意几点，设置的<code>CGContextScaleCTM</code>, <code>CGContextTranslateCTM</code>, <code>CGContextRotateCTM</code>等方法改变的是上下文的坐标系参数；不同的设置顺序返回的最终自定义的坐标系结果也是不尽相同。<br>在调适的时候，由于设计的坐标系调整相对复杂，对已有的方法做调整可能牵一发而动全身，无法知道之间的必然联系。建议先思考自己需要的图片调整结果的理想步骤，再逐步实现并测试每步步骤，一步步达到最终效果。😂不过应该是我不太熟悉，调了好久，期间都快挠破头皮，最终才实现需要的效果。</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.jianshu.com/p/ad8eed568ff4" target="_blank" rel="noopener">CGContext图形上下文详解</a><br><a href="https://www.jianshu.com/p/c32f6a931232" target="_blank" rel="noopener">CGContext-上下文（画布）的应用</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;需求&quot;&gt;&lt;a href=&quot;#需求&quot; class=&quot;headerlink&quot; title=&quot;需求&quot;&gt;&lt;/a&gt;需求&lt;/h2&gt;&lt;p&gt;需要围绕任意点旋转若干角度返回和原始图片大小相同的图片。&lt;/p&gt;
&lt;h2 id=&quot;实现&quot;&gt;&lt;a href=&quot;#实现&quot; class=&quot;head
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://michaelin1208.github.io/tags/iOS/"/>
    
      <category term="CGContext" scheme="https://michaelin1208.github.io/tags/CGContext/"/>
    
      <category term="围绕任意点" scheme="https://michaelin1208.github.io/tags/%E5%9B%B4%E7%BB%95%E4%BB%BB%E6%84%8F%E7%82%B9/"/>
    
      <category term="旋转任意角度" scheme="https://michaelin1208.github.io/tags/%E6%97%8B%E8%BD%AC%E4%BB%BB%E6%84%8F%E8%A7%92%E5%BA%A6/"/>
    
  </entry>
  
  <entry>
    <title>WKWebView通过监听ContentSize更新WebView的Frame导致Height持续增长的bug解决方案（编辑于2018081</title>
    <link href="https://michaelin1208.github.io/2018/07/19/iOS/WKWebView%E9%80%9A%E8%BF%87%E7%9B%91%E5%90%ACContentSize%E6%9B%B4%E6%96%B0WebView%E7%9A%84Frame%E5%AF%BC%E8%87%B4Height%E6%8C%81%E7%BB%AD%E5%A2%9E%E9%95%BF%E7%9A%84bug%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%88%E7%BC%96%E8%BE%91%E4%BA%8E2018081/"/>
    <id>https://michaelin1208.github.io/2018/07/19/iOS/WKWebView通过监听ContentSize更新WebView的Frame导致Height持续增长的bug解决方案（编辑于2018081/</id>
    <published>2018-07-19T13:33:46.000Z</published>
    <updated>2018-10-30T07:45:13.284Z</updated>
    
    <content type="html"><![CDATA[<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>最近眼红WKWebView相对UIWebView的高可配置和高效。在最近的代码中选择使用WKWebView来加载JS动态页面。但是需要把WebView嵌入到另一个ScrollView中显示，所以需要拉伸到内容长度且不能被用户拖动。原始代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (void)webView:(WKWebView *)webView didFinishNavigation:(WKNavigation *)navigation &#123;</span><br><span class="line">    [webView evaluateJavaScript:@&quot;document.body.scrollHeight&quot; completionHandler:^(NSNumber *height, NSError * _Nullable error) &#123;</span><br><span class="line">        float htmlHeight =[height floatValue];</span><br><span class="line">        CGRect webFrame = webView.frame;</span><br><span class="line">        webFrame.size.height = htmlHeight;</span><br><span class="line">        webView.frame = webFrame;</span><br><span class="line">        [self addFeedBackBtn];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过JS代码得到页面的高度。<br><strong>但是这样的方法对于非静态页面无效，高度并非正确的高度。</strong></p><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><hr><p><strong>编辑于20180813</strong><br>下面的分割线后是最初始的解决办法，但是在部分极端情况下还有用户反应会出现高度持续增长的问题。<br><strong>最终找到的原因</strong>是<code>WKWebView</code>的<code>frame</code>宽度带有小数，而不是整数。猜测<code>WKWebView</code>在计算<code>contentSize</code>的时候是依照<code>frame.width</code>向下取整的宽度来计算最终的<code>contentSize</code>的<code>height</code>的，然后导致KVO观察的contentSize高度在更新frame高度后持续增加。<br><strong>更新的解决办法是</strong>对WKWebView的frame宽度求整。</p><p><strong>代码如下<code>_webView.frame = CGRectMake(HWFrame_IPhonePadX(20, 30), height, (NSInteger)(ScreenWidth - HWFrame_IPhonePadX(60, 80)), 0);</code>。</strong></p><p>BTW. 之所以我们的<code>WKWebView</code>的<code>frame</code>宽度会带小数是因为我们的<code>HWFrame_IPhonePadX</code>宏会自适应屏幕宽高生成输入数值对应的实际显示数值（这个数字是比例计算而来，会带有小数位）。所以就尴尬了，产生了<code>WKWebView</code>高度持续增加的bug。</p><hr><p><strong>初始解决方案</strong><br>为了监控JS动态页面的当前高度，选择使用KVO监听<code>WKWebView.scrollView</code>的contentSize变化。在收到变化通知是，通过当前的contentSize更新webView的frame。代码如下：</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSKeyValueChangeKey</span>,<span class="keyword">id</span>&gt; *)change context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line">    <span class="keyword">if</span> (object == _webView.scrollView &amp;&amp; [keyPath isEqualToString:<span class="string">@"contentSize"</span>]) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"_webView.scrollView.contentSize %f %f"</span>, <span class="keyword">self</span>.webView.scrollView.contentSize.width, <span class="keyword">self</span>.webView.scrollView.contentSize.height);</span><br><span class="line">        <span class="built_in">CGRect</span> webFrame = <span class="keyword">self</span>.webView.frame;</span><br><span class="line">        webFrame.size.height = <span class="keyword">self</span>.webView.scrollView.contentSize.height;</span><br><span class="line">        <span class="keyword">self</span>.webView.frame = webFrame;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该方法可以基本解决访问动态页面，实时更新页面高度的问题。</p><p><strong>使用KVO记得移除Observer，同时避免过度移除的crash。</strong>可以使用下方代码解决<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)removeWebViewObserver &#123;</span><br><span class="line">    <span class="keyword">@try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (_webView) &#123;</span><br><span class="line">            [_webView.scrollView removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"contentSize"</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"多次删除kvo 报错了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h4 id="偶发问题"><a href="#偶发问题" class="headerlink" title="偶发问题"></a>偶发问题</h4><p>上方方法小概率下会出现监听持续被触发，<code>contentSize.height</code>持续不断增加，从而使得设置的<code>frame</code>的高度也在不断增加，无限循环增高。<br>我当时工程内的表现为高度每次加一。</p><h5 id="解决方案一"><a href="#解决方案一" class="headerlink" title="解决方案一"></a>解决方案一</h5><p>通过<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSKeyValueChangeKey</span>,<span class="keyword">id</span>&gt; *)change context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line">    <span class="keyword">if</span> (object == _webView.scrollView &amp;&amp; [keyPath isEqualToString:<span class="string">@"contentSize"</span>]) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"_webView.scrollView.contentSize %f %f"</span>, <span class="keyword">self</span>.webView.scrollView.contentSize.width, <span class="keyword">self</span>.webView.scrollView.contentSize.height);</span><br><span class="line">        <span class="built_in">CGRect</span> webFrame = <span class="keyword">self</span>.webView.frame;</span><br><span class="line">        webFrame.size.height = <span class="keyword">self</span>.webView.scrollView.contentSize.height - <span class="number">1</span>;    <span class="comment">// 每次减一可以结局死循环，持续增加高度。</span></span><br><span class="line">        <span class="keyword">self</span>.webView.frame = webFrame;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>该办法可以解决持续增加高度的问题。但是没有找到根本原因，无法确定所有页面都是每次加一，还是有其他可能的情况。<strong>所以该方法放弃。</strong></p><h5 id="解决方案二"><a href="#解决方案二" class="headerlink" title="解决方案二"></a>解决方案二</h5><p>把WKWebView更换为UIWebView，同样也通过监听<code>contentSize</code>来动态更新webView高度，没有出现上方的偶发问题，高度不会持续增加。<br>但是WKWebView比UIWebView更加高效和苹果更加推荐，<strong>所以也放弃。</strong></p><h5 id="解决方案三"><a href="#解决方案三" class="headerlink" title="解决方案三"></a>解决方案三</h5><p>测试代码，发现如果不仅仅更新frame的height，取而代之的通过contentSize同时更新webView的frame的宽高，就不会出现高度的持续增高。但是页面内容宽度会失去限制，超过webView页面范围。</p><p><strong>最终解决方案是通过JS代码限制webView的内容宽度。</strong><br>方案是不更改监听代码，也不对监听得到的高度减一。更新WKNavigationDelegate的<code>- (void)webView:(WKWebView *)webView didFinishNavigation:(WKNavigation *)navigation</code>如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (void)webView:(WKWebView *)webView didFinishNavigation:(WKNavigation *)navigation &#123;</span><br><span class="line">    if (webView == _webView) &#123;</span><br><span class="line">        NSString *meta = [NSString stringWithFormat:@&quot;document.getElementsByName(\&quot;viewport\&quot;)[0].content = \&quot;width=self.webView.frame.size.width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no\&quot;&quot;];</span><br><span class="line">        [_webView evaluateJavaScript:meta completionHandler:^(id _Nullable complete, NSError * _Nullable error) &#123;</span><br><span class="line">            if (complete != nil) &#123;</span><br><span class="line">                NSLog(@&quot;complete %@&quot;, complete);</span><br><span class="line">            &#125; else if (error) &#123;</span><br><span class="line">                NSLog(@&quot;error %@&quot;, error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过强制设置页面的宽度为我们当前的webView的宽度。解决偶尔出现的高度持续增加的Bug。</p><h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p><a href="https://stackoverflow.com/questions/3936041/how-to-determine-the-content-size-of-a-uiwebview" target="_blank" rel="noopener">How to determine the content size of a UIWebView?</a><br><a href="https://blog.csdn.net/yibuyibulai/article/details/43795095" target="_blank" rel="noopener">iOS 修改webView字体大小,设置宽度及缩放效果</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h3&gt;&lt;p&gt;最近眼红WKWebView相对UIWebView的高可配置和高效。在最近的代码中选择使用WKWebView来加载JS动态页面
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://michaelin1208.github.io/tags/iOS/"/>
    
      <category term="WKWebView" scheme="https://michaelin1208.github.io/tags/WKWebView/"/>
    
      <category term="监听" scheme="https://michaelin1208.github.io/tags/%E7%9B%91%E5%90%AC/"/>
    
      <category term="ContentSize" scheme="https://michaelin1208.github.io/tags/ContentSize/"/>
    
      <category term="Height" scheme="https://michaelin1208.github.io/tags/Height/"/>
    
      <category term="持续增长" scheme="https://michaelin1208.github.io/tags/%E6%8C%81%E7%BB%AD%E5%A2%9E%E9%95%BF/"/>
    
  </entry>
  
  <entry>
    <title>Error-1053--The-service-did-not-respond-to-the-start-or-control-reques</title>
    <link href="https://michaelin1208.github.io/2018/05/02/Python/Error-1053--The-service-did-not-respond-to-the-start-or-control-reques/"/>
    <id>https://michaelin1208.github.io/2018/05/02/Python/Error-1053--The-service-did-not-respond-to-the-start-or-control-reques/</id>
    <published>2018-05-02T02:33:46.000Z</published>
    <updated>2018-10-30T07:45:13.283Z</updated>
    
    <content type="html"><![CDATA[<p>最近在把Python的定时程序放进Windows服务时遇到了上述的问题‘错误1053：服务没有及时响应启动或控制请求’ 或者 ‘Error 1053: The service did not respond to the start or control request in a timely fashion’。<br>可以正常安装<code>python PythonFileName.py install</code>，<br>不能正常启动<code>python PythonFileName.py start</code>。<br>尝试使用<code>python PythonFileName.py debug</code>检查代码，没有发现代码问题，考虑应该是环境问题。</p><p>最终在StackOverflow的 <a href="https://stackoverflow.com/questions/8943371/cant-start-windows-service-written-in-python-win32serviceutil" target="_blank" rel="noopener">Can’t start Windows service written in Python (win32serviceutil)</a> 中找到了 <a href="https://stackoverflow.com/users/3220983/buvinj" title="2,840 reputation" target="_blank" rel="noopener">BuvinJ</a> 的回答：“It might prove useful in this case to also add these directories to your system path: C:\Python27\Lib\site-packages\win32 and C:\Python27\Lib\site-packages\pywin32_system32. That will let you use pythonservice more easily.  ”</p><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>在cmd中输入<br><code>setx /M PATH &quot;%PATH%;C:\Python27;C:\Users\Administrator\Anaconda2\Scripts;C:\Users\Administrator\Anaconda2\Lib\site-packages\pywin32_system32;C:\Users\Administrator\Anaconda2\Lib\site-packages\win32&quot;</code><br>回车，增加两个路径的引用。然后就能启动服务了。</p><p>具体的Windows服务Python代码：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import win32serviceutil</span><br><span class="line">import win32service</span><br><span class="line">import win32event</span><br><span class="line">import servicemanager</span><br><span class="line">import winerror</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> StockRecommendRunLoop(win32serviceutil.ServiceFramework):</span><br><span class="line">    _svc_name_ = <span class="string">"StockRecommendRunLoop"</span></span><br><span class="line">    _svc_display_name_ = <span class="string">"Stock Recommend Run Loop"</span></span><br><span class="line"></span><br><span class="line">    def __init__(<span class="keyword">self</span>, args):</span><br><span class="line">        win32serviceutil.ServiceFramework.__init__(<span class="keyword">self</span>, args)</span><br><span class="line">        <span class="keyword">self</span>.hWaitStop = win32event.CreateEvent(None, <span class="number">0</span>, <span class="number">0</span>, None)</span><br><span class="line"></span><br><span class="line">    def SvcStop(<span class="keyword">self</span>):</span><br><span class="line">        <span class="keyword">self</span>.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)</span><br><span class="line">        win32event.SetEvent(<span class="keyword">self</span>.hWaitStop)</span><br><span class="line"></span><br><span class="line">    def SvcDoRun(<span class="keyword">self</span>):</span><br><span class="line">        <span class="keyword">self</span>.ReportServiceStatus(win32service.SERVICE_RUNNING)</span><br><span class="line">        <span class="keyword">self</span>.start_task()</span><br><span class="line">        win32event.WaitForSingleObject(<span class="keyword">self</span>.hWaitStop, win32event.INFINITE)</span><br><span class="line"></span><br><span class="line">if __name__ == '__main__':</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) == <span class="number">1</span>:</span><br><span class="line">        try:</span><br><span class="line">            servicemanager.Initialize()</span><br><span class="line">            servicemanager.PrepareToHostSingle(StockRecommendRunLoop)</span><br><span class="line">            servicemanager.StartServiceCtrlDispatcher()</span><br><span class="line">        except win32service.error, details:</span><br><span class="line">            <span class="keyword">if</span> details[<span class="number">0</span>] == winerror.ERROR_FAILED_SERVICE_CONTROLLER_CONNECT:</span><br><span class="line">                win32serviceutil.usage()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        win32serviceutil.HandleCommandLine(StockRecommendRunLoop)</span><br></pre></td></tr></table></figure></p><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference:"></a>Reference:</h3><p><a href="https://stackoverflow.com/questions/8943371/cant-start-windows-service-written-in-python-win32serviceutil" target="_blank" rel="noopener">Can’t start Windows service written in Python (win32serviceutil)</a><br><a href="https://blog.csdn.net/zhou191954/article/details/8290010" target="_blank" rel="noopener">Python Windows Service的方式运行</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近在把Python的定时程序放进Windows服务时遇到了上述的问题‘错误1053：服务没有及时响应启动或控制请求’ 或者 ‘Error 1053: The service did not respond to the start or control request i
      
    
    </summary>
    
      <category term="Python" scheme="https://michaelin1208.github.io/categories/Python/"/>
    
    
      <category term="Python" scheme="https://michaelin1208.github.io/tags/Python/"/>
    
      <category term="Error-1053" scheme="https://michaelin1208.github.io/tags/Error-1053/"/>
    
  </entry>
  
  <entry>
    <title>Apple-Watch-“密码错误”-问题解决-和-还原初始化方式</title>
    <link href="https://michaelin1208.github.io/2017/09/19/Apple/Apple-Watch-%E2%80%9C%E5%AF%86%E7%A0%81%E9%94%99%E8%AF%AF%E2%80%9D-%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3-%E5%92%8C-%E8%BF%98%E5%8E%9F%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B9%E5%BC%8F/"/>
    <id>https://michaelin1208.github.io/2017/09/19/Apple/Apple-Watch-“密码错误”-问题解决-和-还原初始化方式/</id>
    <published>2017-09-19T02:33:46.000Z</published>
    <updated>2019-04-25T10:02:07.704Z</updated>
    
    <content type="html"><![CDATA[<h3 id="最近莫名其妙遇到的Apple-Watch无法解锁的问题"><a href="#最近莫名其妙遇到的Apple-Watch无法解锁的问题" class="headerlink" title="最近莫名其妙遇到的Apple Watch无法解锁的问题"></a>最近莫名其妙遇到的Apple Watch无法解锁的问题</h3><p>这个问题几乎是一个死循环。首先手机的蓝牙无法正常的连接到曾经配对过的Apple Watch，同时手表提示“密码错误 请在 iPhone 打开Apple Watch 应用，前往Passcode，轻按“重启密码”再试。”。<br><img src="http://upload-images.jianshu.io/upload_images/2312364-0bbfab50b8310e78.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="借用下网友的错误图片"><br>很尴尬，手机连不上手表，无法重启密码。手表所有按键都提示这段话。</p><h3 id="晚上搜索了还原办法，多数说的是按住边上的电源键和表冠健，直到出现白苹果，再松开。但是尝试后并没有还原，依然还是这一段提示。"><a href="#晚上搜索了还原办法，多数说的是按住边上的电源键和表冠健，直到出现白苹果，再松开。但是尝试后并没有还原，依然还是这一段提示。" class="headerlink" title="晚上搜索了还原办法，多数说的是按住边上的电源键和表冠健，直到出现白苹果，再松开。但是尝试后并没有还原，依然还是这一段提示。"></a>晚上搜索了还原办法，多数说的是按住边上的电源键和表冠健，直到出现白苹果，再松开。但是尝试后并没有还原，依然还是这一段提示。</h3><p>之后联系了客服，才得知有另一种还原的办法：就是<strong>“长按电源键直到出现关机滑动条，此时不要滑动关机键，而是用力点击（force touch）关机条中间，之后便会出现‘抹掉内容并恢复出厂设置’按钮。”</strong>之后再用手机和手表配对，然后恢复备份就能搞定这个问题了。</p><p><strong><a href="http://bbs.feng.com/forum.php?mod=forumdisplay&amp;fid=573&amp;filter=typeid&amp;typeid=742" target="_blank" rel="noopener">[求助已解决]这是什么鬼？求解—————-已解决</a></strong><br>感谢楼主的图，原来楼下高人已经提供了这个还原办法，白和客服妹子聊了一小时天了<br>$x + y = z$</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;最近莫名其妙遇到的Apple-Watch无法解锁的问题&quot;&gt;&lt;a href=&quot;#最近莫名其妙遇到的Apple-Watch无法解锁的问题&quot; class=&quot;headerlink&quot; title=&quot;最近莫名其妙遇到的Apple Watch无法解锁的问题&quot;&gt;&lt;/a&gt;最近莫名其
      
    
    </summary>
    
      <category term="Apple" scheme="https://michaelin1208.github.io/categories/Apple/"/>
    
    
      <category term="Apple" scheme="https://michaelin1208.github.io/tags/Apple/"/>
    
      <category term="Watch" scheme="https://michaelin1208.github.io/tags/Watch/"/>
    
      <category term="密码错误" scheme="https://michaelin1208.github.io/tags/%E5%AF%86%E7%A0%81%E9%94%99%E8%AF%AF/"/>
    
      <category term="重启" scheme="https://michaelin1208.github.io/tags/%E9%87%8D%E5%90%AF/"/>
    
  </entry>
  
  <entry>
    <title>MMDraggableTagView实现排坑</title>
    <link href="https://michaelin1208.github.io/2017/03/27/iOS/MMDraggableTagView%E5%AE%9E%E7%8E%B0%E6%8E%92%E5%9D%91/"/>
    <id>https://michaelin1208.github.io/2017/03/27/iOS/MMDraggableTagView实现排坑/</id>
    <published>2017-03-27T02:33:46.000Z</published>
    <updated>2018-10-30T07:45:13.284Z</updated>
    
    <content type="html"><![CDATA[<p>最近需要实现个<a href="https://github.com/michaelin1208/ChargeApp/tree/MMDraggableTagView" target="_blank" rel="noopener">MMDraggableTagView</a>来实现类似网易新闻中的新闻类型管理或者其他的应用中标签管理页面，同时需要它最好能够拖拽，同时可以有层级关系。在工程中我们使用了 <a href="https://github.com/SnapKit/SnapKit" target="_blank" rel="noopener">SnapKit</a> 来管理autolayout的constraints，这个三方库和 <a href="https://github.com/SnapKit/Masonry" target="_blank" rel="noopener">Masonry</a> 类似，只是 one for ObjC, one for Swift. </p><h3 id="问题列表（Swift菜鸟问题，熟练工略过）"><a href="#问题列表（Swift菜鸟问题，熟练工略过）" class="headerlink" title="问题列表（Swift菜鸟问题，熟练工略过）"></a>问题列表（Swift菜鸟问题，熟练工略过）</h3><p><strong>1. 通过SnapKit，重复更新autolayout时，页面显示位置不正常</strong><br>最初采用<code>public func makeConstraints(_ closure: (_ make: ConstraintMaker) -&gt; Void)</code>来添加constraints，但是重复使用会遗留下之前添加的constraints。需要使用<code>public func remakeConstraints(_ closure: (_ make: ConstraintMaker) -&gt; Void)</code>来实现删除之前的constraints，并创建新的constraints。</p><p><strong>2. 通过更新视图的constraints来实现视图的动画效果。</strong><br>一开始通过在UIView的animate block中实现constraints更新，但是并没有动画效果<br>正确方法是：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIView</span>.animate(withDuration: <span class="number">0.2</span>, animations: &#123;</span><br><span class="line">      <span class="keyword">self</span>.relocateTags()         <span class="comment">// update autolayout constraints by SnapKit.</span></span><br><span class="line">      <span class="keyword">self</span>.layoutIfNeeded()       <span class="comment">// call layout method if needed to update subviews.</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>需要调用<code>layoutIfNeeded()</code>来更新子页面，不然其实子视图不会更新位置，只更新constraints。</p><p><strong>3. 视图被拖拽时，出现视图因为之前的关联对象的位移，而产生同样的位移</strong><br>考虑是因为之前被拖拽视图设置的与周边子视图相关的constraints导致的。因此可以通过SnapKit中的<code>public func removeConstraints()</code>来直接删除所有的限制。但是因为删除了所有constraints，会导致视图移动到最初左上角的位置。因此采用了个折中的办法，<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">draggingCell!.snp.remakeConstraints &#123; (make) <span class="keyword">in</span></span><br><span class="line">      make.top.equalTo(<span class="keyword">self</span>).offset(draggingCell!.frame.origin.y)</span><br><span class="line">      make.left.equalTo(<span class="keyword">self</span>).offset(draggingCell!.frame.origin.x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>更新他的constraints，删除与周边subviews相关的constraints，设置为与superview的相关关系。这样就不会因为相关的subviews的位置变化而影响自己的视图。</p><h3 id="未完待续"><a href="#未完待续" class="headerlink" title="未完待续"></a>未完待续</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近需要实现个&lt;a href=&quot;https://github.com/michaelin1208/ChargeApp/tree/MMDraggableTagView&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;MMDraggableTagView&lt;/a&gt;
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://michaelin1208.github.io/tags/iOS/"/>
    
      <category term="MMDraggableTagView" scheme="https://michaelin1208.github.io/tags/MMDraggableTagView/"/>
    
  </entry>
  
  <entry>
    <title>sudo-gem-install-cocoapods更新CocoaPods失败、无权限的解决办法</title>
    <link href="https://michaelin1208.github.io/2017/03/20/iOS/sudo-gem-install-cocoapods%E6%9B%B4%E6%96%B0CocoaPods%E5%A4%B1%E8%B4%A5%E3%80%81%E6%97%A0%E6%9D%83%E9%99%90%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <id>https://michaelin1208.github.io/2017/03/20/iOS/sudo-gem-install-cocoapods更新CocoaPods失败、无权限的解决办法/</id>
    <published>2017-03-20T02:33:46.000Z</published>
    <updated>2018-10-30T07:45:13.284Z</updated>
    
    <content type="html"><![CDATA[<p><code>sudo gem install cocoapods</code>更新CocoaPods，或者<code>sudo gem update --system</code>更新gem。却提醒失败，无权限。<br><img src="http://upload-images.jianshu.io/upload_images/2312364-e9a9907d6bb0e042.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="更新失败 提示无权限"><br>但是已经加了sudo，考虑是路径问题。</p><h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><p>用下面的代码指定路径就能安装成功了。<br><code>sudo gem install -n /usr/bin/pod cocoapods</code>安装CocoaPods<br>或者<br><code>sudo gem update -n /usr/local/bin --system</code>安装Gem</p><h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p><a href="http://stackoverflow.com/questions/33015875/operation-not-permitted-usr-bin-update-rubygems" target="_blank" rel="noopener">Operation not permitted - /usr/bin/update_rubygems</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;code&gt;sudo gem install cocoapods&lt;/code&gt;更新CocoaPods，或者&lt;code&gt;sudo gem update --system&lt;/code&gt;更新gem。却提醒失败，无权限。&lt;br&gt;&lt;img src=&quot;http://upload-ima
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://michaelin1208.github.io/tags/iOS/"/>
    
      <category term="CocoaPods" scheme="https://michaelin1208.github.io/tags/CocoaPods/"/>
    
      <category term="sudo-gem-install-cocoapods" scheme="https://michaelin1208.github.io/tags/sudo-gem-install-cocoapods/"/>
    
      <category term="无权限" scheme="https://michaelin1208.github.io/tags/%E6%97%A0%E6%9D%83%E9%99%90/"/>
    
  </entry>
  
  <entry>
    <title>CocoaPods-trunk-push发布成功后无法pod-search到</title>
    <link href="https://michaelin1208.github.io/2017/03/20/iOS/CocoaPods-trunk-push%E5%8F%91%E5%B8%83%E6%88%90%E5%8A%9F%E5%90%8E%E6%97%A0%E6%B3%95pod-search%E5%88%B0/"/>
    <id>https://michaelin1208.github.io/2017/03/20/iOS/CocoaPods-trunk-push发布成功后无法pod-search到/</id>
    <published>2017-03-20T02:33:46.000Z</published>
    <updated>2020-02-25T06:29:05.677Z</updated>
    
    <content type="html"><![CDATA[<h2 id="现象："><a href="#现象：" class="headerlink" title="现象："></a>现象：</h2><p>按照上一篇文章<a href="http://www.jianshu.com/p/61cc4121a0ee" target="_blank" rel="noopener">《MMNumberScrollView数字滚动动画视图和Cocoapods实践笔记》</a>介绍，实现了新建并编辑podspace，然后通过<code>pod trunk push yourSpaceName.podspec</code>来push我们自己的CocoaPods库到<a href="https://github.com/CocoaPods/Specs" target="_blank" rel="noopener">CocoaPods官方git</a>。</p><p>上传成功后，按照之前的文章介绍，可以使用<code>pod search YouUploadCocoaPodsSpaceName</code> 来找到你的工程。理应显示<br><img src="http://upload-images.jianshu.io/upload_images/2312364-deb7ef62c1e4cad3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="预期效果"><br>但是显示的是😂<br><img src="http://upload-images.jianshu.io/upload_images/2312364-0c8d7f7fa5364d69.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="实际效果"></p><h2 id="解决办法："><a href="#解决办法：" class="headerlink" title="解决办法："></a>解决办法：</h2><p>网上介绍这类的解决方法是<code>pod setup</code>来更新我们本地的CocoaPods space库，然后再用<code>pod search</code>便找到我们发布的工程。但是我使用后始终无效。</p><p>怀疑是否会是因为需要审核，可能需要些时间。但是今天发现依然如此，便进到<a href="https://github.com/CocoaPods/Specs" target="_blank" rel="noopener">CocoaPods官方git</a>搜索，发现我的库已经被收录。</p><p><strong>于是再次搜索解决方案，发现可能是本地的搜索时的本地缓存有问题。</strong><br>可以在终端中输入<br><code>rm ~/Library/Caches/CocoaPods/search_index.json</code><br>来清除缓存，再通过<br><code>pod search YouUploadCocoaPodsSpaceName</code><br>来搜索<br><img src="http://upload-images.jianshu.io/upload_images/2312364-deb7ef62c1e4cad3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="最终效果"><br>这样就可以搜索到自己发布成功的CocoaPods库了。</p><h3 id="Reference："><a href="#Reference：" class="headerlink" title="Reference："></a>Reference：</h3><p><a href="http://blog.sina.com.cn/s/blog_14d7dd6710102wc1w.html" target="_blank" rel="noopener">解决cocoapods安装完成后不能 pod search的问题</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;现象：&quot;&gt;&lt;a href=&quot;#现象：&quot; class=&quot;headerlink&quot; title=&quot;现象：&quot;&gt;&lt;/a&gt;现象：&lt;/h2&gt;&lt;p&gt;按照上一篇文章&lt;a href=&quot;http://www.jianshu.com/p/61cc4121a0ee&quot; target=&quot;_bl
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://michaelin1208.github.io/tags/iOS/"/>
    
      <category term="CocoaPods" scheme="https://michaelin1208.github.io/tags/CocoaPods/"/>
    
      <category term="trunk" scheme="https://michaelin1208.github.io/tags/trunk/"/>
    
      <category term="push" scheme="https://michaelin1208.github.io/tags/push/"/>
    
      <category term="pod" scheme="https://michaelin1208.github.io/tags/pod/"/>
    
      <category term="search" scheme="https://michaelin1208.github.io/tags/search/"/>
    
  </entry>
  
  <entry>
    <title>我的CSDN博客地址</title>
    <link href="https://michaelin1208.github.io/2017/03/16/csdn/"/>
    <id>https://michaelin1208.github.io/2017/03/16/csdn/</id>
    <published>2017-03-16T09:06:18.000Z</published>
    <updated>2018-10-30T07:45:13.283Z</updated>
    
    <content type="html"><![CDATA[<p>原来CSDN博客地址<a href="http://blog.csdn.net/michaelin1208" target="_blank" rel="noopener">michaelin1208</a>。 懒得一篇篇文章搬运了，记录下方便以后查找😊。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;原来CSDN博客地址&lt;a href=&quot;http://blog.csdn.net/michaelin1208&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;michaelin1208&lt;/a&gt;。 懒得一篇篇文章搬运了，记录下方便以后查找😊。&lt;/p&gt;

      
    
    </summary>
    
      <category term="Others" scheme="https://michaelin1208.github.io/categories/Others/"/>
    
    
      <category term="CSDN" scheme="https://michaelin1208.github.io/tags/CSDN/"/>
    
      <category term="博客" scheme="https://michaelin1208.github.io/tags/%E5%8D%9A%E5%AE%A2/"/>
    
  </entry>
  
  <entry>
    <title>MMNumberScrollView数字滚动动画视图和Cocoapods实践笔记</title>
    <link href="https://michaelin1208.github.io/2017/03/16/iOS/MMNumberScrollView%E6%95%B0%E5%AD%97%E6%BB%9A%E5%8A%A8%E5%8A%A8%E7%94%BB%E8%A7%86%E5%9B%BE%E5%92%8CCocoapods%E5%AE%9E%E8%B7%B5%E7%AC%94%E8%AE%B0/"/>
    <id>https://michaelin1208.github.io/2017/03/16/iOS/MMNumberScrollView数字滚动动画视图和Cocoapods实践笔记/</id>
    <published>2017-03-16T08:33:46.000Z</published>
    <updated>2018-10-30T07:45:13.284Z</updated>
    
    <content type="html"><![CDATA[<h2 id="MMNumberScrollView数字滚动动画视图"><a href="#MMNumberScrollView数字滚动动画视图" class="headerlink" title="MMNumberScrollView数字滚动动画视图"></a>MMNumberScrollView数字滚动动画视图</h2><p>之前项目中需要一个动画显示礼物数字增长的视图。最近把它拿来修改下，共享出来。具体的代码可从 <strong><a href="https://github.com/michaelin1208/MMNumberScrollView" target="_blank" rel="noopener">MMNumberScrollView in GitHub</a></strong> 下载。<br>本数字滚动视图可以实现用户自定义滚动图案，滚动速度，和是否动态控制视图大小。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line">#import &quot;MMSingleNumberScrollView.h&quot;</span><br><span class="line"></span><br><span class="line">@class MMNumberScrollViewManager;</span><br><span class="line"></span><br><span class="line">@protocol MMNumberScrollViewManagerDelegate &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">- (void)numberScrollViewManagerFinishedIncreasing:(MMNumberScrollViewManager *)manager;     // delegate method is callbacked when the number scroll view manager finish a increasing operation.</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface MMNumberScrollViewManager:UIView &lt;UIScrollViewDelegate, MMSingleNumberScrollViewDelegate&gt;</span><br><span class="line"></span><br><span class="line">@property (nonatomic,strong) NSMutableArray *numImageArray;  // a mutable array of number images shown in number scroll view.</span><br><span class="line">@property (nonatomic) NSTimeInterval speedDuration;  // roll speed, the duration of each increasing scrolling. The default value is 1 second.</span><br><span class="line">@property (nonatomic) BOOL isShowingFinalSize;  // is it show final size at beginning. Default value is &apos;YES&apos;, the size of scroll view is not increasing during scrolling.</span><br><span class="line"></span><br><span class="line">@property (nonatomic, weak) id&lt;MMNumberScrollViewManagerDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line">// increase number displayed in the manager&apos;s view from currentCount to targetCount.</span><br><span class="line">// You would better to start another increasing after last increasing operation finished (by &quot;- (void)numberScrollViewManagerFinishedIncreasing:(MMNumberScrollViewManager *)manager;&quot;)</span><br><span class="line">// or remove all existed number scroll views (&quot;- (void)removeAllNumberScrollViews;&quot;).</span><br><span class="line">- (void)increaseNumberFrom:(int)currentCount to:(int)targetCount;</span><br><span class="line"></span><br><span class="line">// init the number scroll view manager to contral all single number scroll views.</span><br><span class="line">- (instancetype)initWithFrame:(CGRect)frame;</span><br><span class="line"></span><br><span class="line">// remove all single number scroll views, if you want to shwo another number increasing.</span><br><span class="line">- (void)removeAllNumberScrollViews;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p><h2 id="Cocoapods实践笔记"><a href="#Cocoapods实践笔记" class="headerlink" title="Cocoapods实践笔记"></a>Cocoapods实践笔记</h2><p>此外最近有些迷恋Cocoapods，最近都在尝试如何把自己的工程中自己工程中的三方库交给CocoaPods来管理。今天也顺道实践下怎么创建CocoaPods。方法可以参考下：<br><strong><a href="http://www.jianshu.com/p/98407f0c175b" target="_blank" rel="noopener">创建CocoaPods的制作过程</a></strong><br><strong><a href="http://www.jianshu.com/p/6e5c0f78200a" target="_blank" rel="noopener">CocoaPods的安装使用和常见问题</a></strong></p><p>没有遇到什么特别的问题，除了个别步骤需要翻墙，推荐下<a href="https://github.com/getlantern/lantern" target="_blank" rel="noopener">Lantern</a>，虽然流量有上限，但是从来没超过。创建过程一切顺利，应该成功了，但是暂时在Cocoapods中还搜索不到我的工程。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;MMNumberScrollView数字滚动动画视图&quot;&gt;&lt;a href=&quot;#MMNumberScrollView数字滚动动画视图&quot; class=&quot;headerlink&quot; title=&quot;MMNumberScrollView数字滚动动画视图&quot;&gt;&lt;/a&gt;MMNumber
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://michaelin1208.github.io/tags/iOS/"/>
    
      <category term="Cocoapods" scheme="https://michaelin1208.github.io/tags/Cocoapods/"/>
    
      <category term="数字滚动动画视图" scheme="https://michaelin1208.github.io/tags/%E6%95%B0%E5%AD%97%E6%BB%9A%E5%8A%A8%E5%8A%A8%E7%94%BB%E8%A7%86%E5%9B%BE/"/>
    
      <category term="MMNumberScrollView" scheme="https://michaelin1208.github.io/tags/MMNumberScrollView/"/>
    
  </entry>
  
  <entry>
    <title>苹果在WWDC2016上宣布的关于应用强制使用https的规定的解决方案</title>
    <link href="https://michaelin1208.github.io/2017/01/10/iOS/%E8%8B%B9%E6%9E%9C%E5%9C%A8WWDC2016%E4%B8%8A%E5%AE%A3%E5%B8%83%E7%9A%84%E5%85%B3%E4%BA%8E%E5%BA%94%E7%94%A8%E5%BC%BA%E5%88%B6%E4%BD%BF%E7%94%A8https%E7%9A%84%E8%A7%84%E5%AE%9A%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>https://michaelin1208.github.io/2017/01/10/iOS/苹果在WWDC2016上宣布的关于应用强制使用https的规定的解决方案/</id>
    <published>2017-01-10T08:33:46.000Z</published>
    <updated>2018-10-30T07:45:13.285Z</updated>
    
    <content type="html"><![CDATA[<h1 id="首先是还算好的好消息"><a href="#首先是还算好的好消息" class="headerlink" title="首先是还算好的好消息"></a>首先是还算好的好消息</h1><p><a href="https://developer.apple.com/news/?id=12212016b" target="_blank" rel="noopener">苹果官方</a>表示：强制使用 HTTPS 的要求将暂时不执行，以便给我们更多的时间来做 HTTPS 的适配工作。具体的执行时间，将在确定后再次发布。因此，我们依然可以在 ‘xxx-Info.plist’ 中设置 ‘App Transport Security Settings’ 的 ‘Allow Arbitrary Loads’ 属性设置为yes，来避开ATS要求。这样我们的应用不再需要任何修改就可访问http的网页。</p><h1 id=""><a href="#" class="headerlink" title=" "></a> </h1><h1 id="其次是出来混总要还的"><a href="#其次是出来混总要还的" class="headerlink" title="其次是出来混总要还的"></a>其次是出来混总要还的</h1><h3 id="首先我们需要把网站配置成支持HTTPS。"><a href="#首先我们需要把网站配置成支持HTTPS。" class="headerlink" title="首先我们需要把网站配置成支持HTTPS。"></a>首先我们需要把网站配置成支持HTTPS。</h3><h4 id="苹果的-ATS-App-Transport-Security-政策对于HTTPS的要求，包括："><a href="#苹果的-ATS-App-Transport-Security-政策对于HTTPS的要求，包括：" class="headerlink" title="苹果的 ATS (App Transport Security) 政策对于HTTPS的要求，包括："></a>苹果的 ATS (App Transport Security) 政策对于HTTPS的要求，包括：</h4><ol><li><p>X.509证书必须至少满足下面一种条件：</p><p>由根证书是操作系统安装的CA颁发；</p><p>由用户或系统管理员信任并安装的根证书颁发；</p></li><li><p>TLS版本必须为TLS 1.2，不使用TLS或使用老版本TLS的连接，访问会失败，基于TLSTool工程可获取服务器支持的TLS相关参数；</p><p>连接必须使用AES-128或AES-256对称加密算法，TLS协商算法必须通过ECDHE密钥交换保证完全正向保密（Perfect Forward Secrecy, PFS），ECDHE密钥必须属于下面一种：</p></li></ol><blockquote><p>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</p><p>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</p><p>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384</p><p>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</p><p>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256</p><p>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA</p><p>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</p><p>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</p><p>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384</p><p>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256</p><p>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA</p></blockquote><ol start="3"><li><p>服务器叶证书必须使用下列的密钥签名：</p><p>至少2048位的RSA密钥；</p><p>至少256位的ECC密钥；</p></li></ol><h4 id="-1"><a href="#-1" class="headerlink" title=" "></a> </h4><h4 id="验证网站是否支持苹果的-ATS-要求"><a href="#验证网站是否支持苹果的-ATS-要求" class="headerlink" title="验证网站是否支持苹果的 ATS 要求"></a>验证网站是否支持苹果的 ATS 要求</h4><p>对于OS X v10.11及以上系统，用户可以在终端中使用</p><blockquote><p>/usr/bin/nscurl –ats-diagnostics –verbose <a href="https://www.baidu.com" target="_blank" rel="noopener">https://www.baidu.com</a></p></blockquote><p>来验证目标网站是否符合 ATS 要求，以及是否需要加入白名单。</p><p>此外，腾讯云也提供了验证是否符合ATS要求的验证 SSL 网页。</p><h3 id="-2"><a href="#-2" class="headerlink" title=" "></a> </h3><h3 id="对于无法支持ATS的网站，尤其是第三方网站的适配方案。"><a href="#对于无法支持ATS的网站，尤其是第三方网站的适配方案。" class="headerlink" title="对于无法支持ATS的网站，尤其是第三方网站的适配方案。"></a>对于无法支持ATS的网站，尤其是第三方网站的适配方案。</h3><p><strong>首先配置 ‘xxx-Info.plist’ 对于用户的 API 请求</strong>，苹果要求是必须使用 HTTPS 的，特别是当这个服务器是属于你们自己管理的话。那么这就需要服务器的同事尽快配置证书好让服务器支持 HTTPS 访问。如果使用的是第三方的 API，而他们没有提供 HTTPS 支持的话，需要在 NSExceptionDomains 中进行添加。具体的添加方式可以参考官方的 <a href="https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html" target="_blank" rel="noopener">App Transport Security Technote</a>，官方对他进行了具体的说明。</p><p>这些都可以在 ‘xxx-Info.plist’ 的 ‘NSAppTransportSecurity’ 中进行配置，具体的内容包括</p><p>NSAllowsArbitraryLoads - Bool类型 - 设置YES即可完全关闭ATS，以便支持所有HTTP请求，默认为NO。</p><p>NSAllowsArbitraryLoadsInWebContent - Bool类型 - 允许应用浏览网页内容时关闭ATS限制。默认为NO，像是 UIWebView 或 WKWebView 需要访问 HTTP 或者不安全的 HTTPS 时，需要设置为YES来允许访问。</p><p>NSAllowsArbitraryLoadsForMedia - Bool类型 - 允许该APP的 AVFoundation 中的 player 可以关闭 ATS 限制。默认为NO，如果媒体内容不支持 HTTPS 可打开该关键字。</p><p>NSAllowsLocalNetworking - Bool类型 - 设置本地网络请求不受 ATS 的限制，默认为NO。</p><p>NSExceptionDomains - Dictionary类型 - 添加白名单域名，对应不同的白名单中的网址设置他们的安全例外内容。需要例外的域名根地址 (不包括 ‘http://‘ 或 ‘https://‘ 的头和 ‘/‘ ) 作为关键字，Dictionary类型，内容为下面的参数。</p><p>NSExceptionMinimumTLSVersion - String类型 - 白名单指定域名支持的TLS版本，苹果要求必须达到TLS 1.2版本，如果你访问的网站仅支持TLS 1.0，那么设置为 ‘TLSv1.0’。</p><p>NSExceptionRequiresForwardSecrecy - Bool类型 - 白名单指定域名是否支持Forward Secrecy，默认值为YES，如果域名不支持完全正向加密，那么设置为NO。具体的加密要求可以阅读上方官方技术文档。</p><p>NSExceptionAllowsInsecureHTTPLoads - Bool类型 - 白名单指定域名禁用ATS，而不仅仅只是允许HTTP访问，默认是NO。</p><p>NSIncludesSubdomains - Bool类型 - 白名单指定该白名单的相关设置是否同样设置它的子域名，默认为NO。</p><p><strong>‘SDWebImage’ 无法下载图片的问题。</strong>在设置了白名单后，出现部分网上的图片无法通过 ‘SDWebImage’ 进行下载的问题。解决方法是在下载图片时，设置 ‘options’ 为 ‘SDWebImageAllowInvalidSSLCertificates’ 来允许SDWebImage类访问无效的SSL认证。</p><blockquote><p>[self.headImageView sd_setImageWithURL:[NSURL URLWithString:headImageStr] placeholderImage:kCLDefaultHeadImage options:SDWebImageAllowInvalidSSLCertificates];</p></blockquote><p><strong>‘AFNetworking’</strong> 在 ATS 打开情况下，对于无效证书 (像是自建证书) 和不匹配域名的证书可能会请求失败，那么我们需要修改请求的安全要求，来允许无效证书和不匹配域名的证书。</p><blockquote><p>AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</p><p>AFSecurityPolicy *securityPolicy = [AFSecurityPolicy defaultPolicy];</p><p>//allowInvalidCertificates 是否允许无效证书（也就是自建的证书），默认为NO//如果是需要验证自建证书，需要设置为YES</p><p>securityPolicy.allowInvalidCertificates = YES;</p><p>//validatesDomainName 是否需要验证域名，默认为YES；</p><p>securityPolicy.validatesDomainName = NO;</p><p>manager.securityPolicy  = securityPolicy;</p><p>manager.responseSerializer = [AFHTTPResponseSerializer serializer];</p><p>[manager POST:urlString parameters:dic success:finishedBlock failure:failedBlock];</p></blockquote><h1 id="-3"><a href="#-3" class="headerlink" title=" "></a> </h1><h1 id="Reference-List"><a href="#Reference-List" class="headerlink" title="Reference List:"></a>Reference List:</h1><p>“Supporting App Transport Security”, <a href="https://developer.apple.com/news/?id=12212016b" target="_blank" rel="noopener">https://developer.apple.com/news/?id=12212016b</a></p><p>“Apple’s Information Property List Key Reference”, <a href="https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html" target="_blank" rel="noopener">https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html</a></p><p>“苹果ATS（强制HTTPS）审核新政解码”, <a href="https://yq.aliyun.com/articles/62563" target="_blank" rel="noopener">https://yq.aliyun.com/articles/62563</a></p><p>“iOS 中 AFNetworking HTTPS 的使用”, <a href="http://www.jianshu.com/p/20d5fb4cd76d" target="_blank" rel="noopener">http://www.jianshu.com/p/20d5fb4cd76d</a></p><p>“苹果新『应用通信安全』的理解和使用”, <a href="http://www.cocoachina.com/ios/20150717/12650.html" target="_blank" rel="noopener">http://www.cocoachina.com/ios/20150717/12650.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;首先是还算好的好消息&quot;&gt;&lt;a href=&quot;#首先是还算好的好消息&quot; class=&quot;headerlink&quot; title=&quot;首先是还算好的好消息&quot;&gt;&lt;/a&gt;首先是还算好的好消息&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://developer.apple.com/n
      
    
    </summary>
    
      <category term="iOS" scheme="https://michaelin1208.github.io/categories/iOS/"/>
    
    
      <category term="iOS" scheme="https://michaelin1208.github.io/tags/iOS/"/>
    
      <category term="WWDC2016" scheme="https://michaelin1208.github.io/tags/WWDC2016/"/>
    
      <category term="https" scheme="https://michaelin1208.github.io/tags/https/"/>
    
  </entry>
  
</feed>
